---
# Zabbix 7.0 LTS Corporate Deployment Playbook
# Target: Kubernetes cluster with Longhorn storage

- name: "ğŸš€ Deploy Zabbix 7.0 LTS to Kubernetes"
  hosts: k8s-master
  gather_facts: false
  vars:
    ansible_ssh_common_args: '-o StrictHostKeyChecking=no'
    kubectl_path: '/usr/bin/kubectl'
    
  tasks:
    - name: "ğŸ¯ Starting Zabbix 7.0 LTS deployment"
      set_fact:
        deployment_info:
          - "ğŸš€ Zabbix 7.0 LTS Corporate Edition"
          - "ğŸ“Š Target: {{ ansible_host }}"
          - "ğŸ”§ Storage: {{ storage.class }}"
          - "ğŸŒ Namespace: {{ network.namespace }}"
          - "ğŸ’¾ PostgreSQL: {{ database.version }}"

    # Infrastructure Setup
    - name: "ğŸ—ï¸  Setup infrastructure"
      include_tasks: tasks/infrastructure.yml

    # Database Deployment  
    - name: "ğŸ—„ï¸  Deploy PostgreSQL database"
      include_tasks: tasks/database.yml

    # Database Schema Initialization
    - name: "ğŸ”§ Initialize database schema"
      include_tasks: tasks/database-init.yml

    # Zabbix Server
    - name: "âš¡ Deploy Zabbix Server"
      include_tasks: tasks/zabbix-server.yml

    # Zabbix Web Interface
    - name: "ğŸŒ Deploy Zabbix Web Interface"
      include_tasks: tasks/zabbix-web.yml

    # Monitoring & Observability
    - name: "ğŸ“Š Setup monitoring"
      include_tasks: tasks/monitoring.yml

    # Final Verification
    - name: "âœ… Verify deployment"
      include_tasks: tasks/verification.yml

    - name: "ğŸ‰ Deployment completed successfully"
      set_fact:
        completion_info:
          - "âœ… Zabbix 7.0 LTS deployed successfully!"
          - "ğŸŒ Web Interface: http://{{ ansible_host }}:30080"
          - "ğŸ” HTTPS: https://{{ ansible_host }}:30443"
          - "ğŸ‘¤ Default Login: Admin / zabbix"
          - "ğŸ“Š Database: PostgreSQL {{ database.version }}"
          - "ğŸ’¾ Storage: {{ storage.postgres.size }}"
          - ""
          - "ğŸš€ Ready for corporate monitoring!"
